<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Certificado FIC - SENA</title>
    <style>
        /* RESET Y ESTILOS GENERALES */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body { 
            font-family: 'Arial', sans-serif;
            font-size: 10px; /* Reducido de 11px */
            color: #000000;
            background-color: #ffffff;
            width: 100%;
            padding: 0;
            margin: 0;
        }
        
        /* CONTENEDOR PRINCIPAL (HOJA A4) */
        .page-container {
            width: 18cm;
            min-height: 29.7cm;
            height: 29.7cm; /* Altura fija */
            background: white;
            margin: 0 auto;
            padding: 1.5cm 2cm 1.5cm 2cm; /* Reducido padding superior e inferior */
            position: relative;
            overflow: hidden;
            /*width: 80%;*/
        }
        
        /* LOGO - MÁS PEQUEÑO */
        .logo-container {
            text-align: center;
            margin: 0 auto 5px auto; /* Reducido margen */
            width: 100%;
        }
        
        .logo {
            height: 70px; /* Reducido de 80px */
            width: auto;
        }
        
        /* ENCABEZADO - MÁS COMPACTO */
        .header {
            text-align: center;
            margin-bottom: 10px; /* Reducido */
        }
        
        .institucion {
            font-size: 14px; /* Reducido de 16px */
            line-height: 1.1;
            margin-bottom: 2px;
            padding: 10px;
        }

        .SENA {
            font-size: 14px; /* Reducido de 16px */
            line-height: 1.1;
            margin-bottom: 2px;
            padding: 18px;

        }
        
        .ministerio {
            font-size: 10px; /* Reducido de 11px */
            font-weight: bold;
            line-height: 1.1;
        }
        
        /* TÍTULO CERTIFICA */
        .certifica-title {
            text-align: center;
            font-size: 14px; /* Reducido de 16px */
            font-weight: bold;
            margin: 10px 0; /* Reducido */
            padding: 12px;

        }
        
        /* PÁRRAFO DE INTRODUCCIÓN */
        .intro-paragraph {
            text-align: left;
            margin: 8px 0 10px 0; /* Reducido */
            font-size: 10px; /* Reducido */
            line-height: 1.1;
            padding: 0 5px;
        }
        
        /* TABLA - SUPER COMPACTA */
        .table-container {
            margin: 10px 0; /* Reducido */
            width: 100%;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid black;
            font-size: 8px; /* Reducido significativamente */
            table-layout: fixed;
            padding: 10px;
        }
        
        th, td {
            border: 1px solid black;
            padding: 2px 1px; /* Reducido padding */
            text-align: center;
            vertical-align: middle;
            word-wrap: break-word;
            overflow: hidden;
        }
        
        th {
            font-weight: bold;
            background-color: #f5f5f5;
            font-size: 8px; /* Reducido */
        }
        
        /* AJUSTES ESPECÍFICOS DE ANCHO PARA CADA COLUMNA */
        .col-licencia { width: 11%; }
        .col-obra { width: 20%; }
        .col-ciudad { width: 11%; }
        .col-valor { width: 13%; }
        .col-periodo { width: 9%; }
        .col-fecha { width: 9%; }
        .col-ticket { width: 9%; }
        
        /* CONTENIDO INFERIOR - EXTRA COMPACTO */
        .content-section {
            margin: 5px 0; /* Reducido significativamente */
            padding: 0 5px;
            line-height: 1.1; /* Reducido */
            text-align: center;
            padding: 10px;
        }
        
        .fecha-expedicion {
            margin-top: 10px; /* Reducido */
            font-size: 9px; /* Reducido */
        }
        
        .advertencia-texto {
            font-weight: bold;
            text-align: center;
            margin: 8px 0; /* Reducido */
            font-size: 9px; /* Reducido */
            line-height: 1.1;
        }
        
        .no-validez {
            font-weight: bold;
            text-align: center;
            margin: 6px 0; /* Reducido */
            font-size: 9px; /* Reducido */
        }
        
        .info-section {
            text-align: center;
            margin: 6px 0; /* Reducido */
            font-size: 9px; /* Reducido */
            line-height: 1.1;
        }
        
        .expedido-por,
        .generado-por {
            text-align: center;
            margin: 4px 0; /* Reducido */
            font-size: 9px; /* Reducido */
        }
        
        .verificacion-box {
            text-align: center;
            margin: 8px 0; /* Reducido */
            font-size: 9px; /* Reducido */
            line-height: 1.1;
        }
        
        /* FOOTER - MÁS PEQUEÑO Y MEJOR POSICIONADO */
        .footer {
            position: absolute;
            bottom: 0.8cm; /* Ajustado para que quepa */
            left: 0;
            right: 0;
            text-align: center;
        }
        
        .footer-image {
            width: 150px; /* Reducido de 180px */
            height: auto;
        }
        
        /* NÚMERO DE PÁGINA */
        .page-number {
            position: absolute;
            bottom: 0.3cm; /* Ajustado */
            right: 2cm;
            font-size: 8px;
            color: #666;
        }
        
        /* UTILIDADES */
        .negrita {
            font-weight: bold;
        }
        
        .uppercase {
            text-transform: uppercase;
        }
        
        .text-center {
            text-align: center;
        }
        
        /* ESTILOS ESPECÍFICOS PARA IMPRESIÓN/PDF */
        @media print {
            body {
                background: white !important;
                padding: 0 !important;
                margin: 0 !important;
                width: 21cm !important;
                height: 29.7cm !important;
                font-size: 9px !important;
            }
            
            .page-container {
                width: 100% !important;
                height: 100% !important;
                min-height: 100% !important;
                max-height: 100% !important;
                margin: 0 !important;
                padding: 1.5cm 2cm 1.5cm 2cm !important;
                box-shadow: none !important;
                page-break-after: avoid !important;
                page-break-inside: avoid !important;
                overflow: hidden !important;
            }
            
            /* Reducir aún más para impresión */
            .logo {
                height: 60px !important;
            }
            
            .institucion {
                font-size: 13px !important;
            }
            
            .certifica-title {
                font-size: 13px !important;
            }
            
            table {
                font-size: 7px !important;
            }
            
            th, td {
                padding: 1px !important;
            }
            
            /* Evitar que los enlaces se muestren en azul */
            a {
                color: black !important;
                text-decoration: none !important;
            }
            
            /* Asegurar que el footer esté en la parte inferior */
            .footer {
                position: fixed !important;
                bottom: 0.8cm !important;
            }
        }
        
        /* ESTILOS PARA VISUALIZACIÓN EN NAVEGADOR */
        @media screen {
            body {
                background-color: #f0f0f0;
                padding: 20px 0;
                display: flex;
                justify-content: center;
                align-items: flex-start;
                min-height: 100vh;
            }
            
            .page-container {
                box-shadow: 0 0 10px rgba(0,0,0,0.1);
            }
            
            .verificacion-box a {
                color: blue;
                text-decoration: underline;
            }
        }
        
        /* CLASE PARA REMOVER ELEMENTOS SI ES NECESARIO */
        .remove-if-needed {
            /* Se puede usar display: none en elementos menos críticos si aún no cabe */
        }
    </style>
</head>
<body>
    <div class="page-container">
        <!-- LOGO CENTRADO -->
        <div class="logo-container">
            <img src="https://www.sena.edu.co/Style%20Library/alayout/images/logoSena.png?rev=40" 
                 alt="Logo SENA" 
                 class="logo">
        </div>
        
        <!-- ENCABEZADO -->
        <div class="header">
            <h1 class="institucion">Servicio Nacional de Aprendizaje</h1>
            <h1 class="SENA">SENA</h1>
            <p class="ministerio">MINISTERIO DE TRABAJO</p>
        </div>
        
        <!-- TÍTULO CERTIFICA -->
        <div class="certifica-title">CERTIFICA:</div>
        
        <!-- CONTENIDO PRINCIPAL -->
       <div class="intro-paragraph">
            @if($certificados->count() > 0)
                Que el constructor con razón social <span class="negrita">{{ $certificados->first()->nombre_empresa }}</span> 
                identificado con el NIT <span class="negrita">{{ $certificados->first()->nitempresa }}</span>, 
                por concepto de Fondo Nacional de Formación Profesional de la Industria de la Construcción FIC, 
                realizó a través del botón electrónico de pagos las siguientes transacciones:
            @else
                Que el constructor con razón social <span class="negrita">NOMBRE DE EMPRESA</span> 
                identificado con el NIT <span class="negrita">XXXXXXXX</span>, 
                por concepto de Fondo Nacional de Formación Profesional de la Industria de la Construcción FIC, 
                realizó a través del botón electrónico de pagos las siguientes transacciones:
            @endif
        </div>
        
        <!-- TABLA DE TRANSACCIONES -->
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th class="col-licencia">
                            <div>N°</div>
                            <div style="font-size: 7px;">Licencia/Contrato</div>
                        </th>
                        <th class="col-obra">Nombre Obra</th>
                        <th class="col-ciudad">Ciudad Ejecución</th>
                        <th class="col-valor">Valor Pago</th>
                        <th class="col-periodo">Periodo</th>
                        <th class="col-fecha">Fecha</th>
                        <th class="col-ticket">Ticket</th>
                    </tr>
                </thead>
                <tbody>
                    @forelse($certificados as $certificado)
                    <tr>
                        <td style="font-size: 8px;">{{ $certificado->nro_licencia_contrato ?? 'N/A' }}</td>
                        <td style="font-size: 8px;">{{ $certificado->nombre_obra ?? '' }}</td>
                        <td style="font-size: 8px;">{{ $certificado->ciudad_obra ?? '' }}</td>
                        <td style="font-size: 8px;">${{ number_format($certificado->valor_pagado ?? 0, 0, ',', '.') }}</td>
                        <td style="font-size: 8px;">{{ $certificado->periodo_pagado ?? '' }}</td>
                        <td style="font-size: 8px;">{{ $certificado->fecha_formateada ?? '' }}</td>
                        <td style="font-size: 8px;">{{ $certificado->ticketid ?? '' }}</td>
                    </tr>
                    @empty
                    <tr>
                        <td colspan="7" class="text-center">
                            No hay transacciones para mostrar
                        </td>
                    </tr>
                    @endforelse
                    
                    <!-- FILA DEL TOTAL -->
                    <tr style="font-weight: bold;">
                        <td colspan="2"></td>
                        <td style="text-align: center; font-size: 8px;">Total</td>
                        <td style="text-align: center; font-size: 8px;">${{ number_format($total ?? 0, 0, ',', '.') }}</td>
                        <td colspan="3"></td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- FECHA DE EXPEDICIÓN -->
        <div class="content-section fecha-expedicion">
            Expedido por el SENA, a los <span class="negrita">{{ numeroEnLetras($fecha_emision->day) }}</span> 
            (<span class="negrita">{{ $fecha_emision->day }}</span>) días del mes de 
            <span class="negrita uppercase">{{ obtenerMesEspanol($fecha_emision->month ?? now()->month) }}</span> de 
            <span class="negrita">{{ $fecha_emision->year ?? now()->year }}</span>
        </div>
        
        <!-- TEXTO DE ADVERTENCIA -->
        <div class="content-section advertencia-texto">
            "LA EXPEDICIÓN DE ESTA CERTIFICACIÓN, NO IMPIDE QUE EL SENA VERIFIQUE LA BASE DE LIQUIDACIÓN DE FIC Y QUE CONSTATE EL CUMPLIMIENTO EN FONDO NACIONAL DE FORMACIÓN PROFESIONAL DE LA INDUSTRIA DE LA CONSTRUCCIÓN FIC."
        </div>
        
        <!-- SECCIÓN DE NO VALIDEZ -->
        <div class="content-section no-validez">NO TIENE VALIDEZ PARA FINES TRIBUTARIOS</div>
        
        <!-- INFORMACIÓN ADICIONAL (OPCIONAL - SE PUEDE REMOVER SI NO CABE) -->
        <div class="content-section info-section remove-if-needed">
            <p>Este documento no tiene validez en procesos de selección contractual con entidades del estado.</p>
            <p>La expedición de esta certificación no impide que el SENA verifique la base de liquidación de aportes y que constate el cumplimiento en Contrato de Aprendizaje.</p>
        </div>
        
        <!-- EXPEDIDO POR -->
        <div class="content-section expedido-por">
            @if($certificados->count() > 0) 
                Expedido por el Servicio Nacional de Aprendizaje – SENA, <span class="negrita">{{ $fecha_emision->format('Y-m-d') }}</span>
            @endif
        </div>
        
        <!-- GENERADO POR (OPCIONAL - SE PUEDE REMOVER SI NO CABE) -->
        <div class="content-section generado-por remove-if-needed">
            Generado por: <span class="negrita">{{ $nombre_usuario ?? 'Sistema SENA' }}</span>
        </div>
        
        <!-- CÓDIGO DE VERIFICACIÓN -->
        <div class="content-section verificacion-box">
            <p>
                ¿Desea saber si este certificado es auténtico?, por favor ingrese a la página web 
                <a href="https://certificadoempresarios.sena.edu.co/">
                    https://certificadoempresarios.sena.edu.co/
                </a> 
                enlace CONSULTAR CODIGO CERTIFICADO y digite:
            </p>
            <p style="margin-top: 10px; font-size: 8px;">
                @if($certificados->count() > 0)
                    el código de verificación: <span class="negrita">{{ $certificados->first()->codigo_verificacion ?? 'CV001' }}</span> 
                    y el Número de Certificado: <span class="negrita">{{ $certificados->first()->numero_certificado ?? 'NC001' }}</span>
                @else
                    el código de verificación: <span class="negrita">#####</span> 
                    y el Número de Certificado: <span class="negrita">#####</span>
                @endif
            </p>
        </div>
        
        <!-- FOOTER -->
        <div class="footer">
            <img src="https://chatbot-sodj.onrender.com/images/footer.jpg" 
            alt="@SENAComunica www.sena.edu.co" 
            class="footer-image">
        </div>
        
        <!-- NÚMERO DE PÁGINA -->
    </div>

</body>
</html>

<?php
function obtenerMesEspanol($mes) {
    $meses = [
        1 => 'enero', 2 => 'febrero', 3 => 'marzo', 4 => 'abril',
        5 => 'mayo', 6 => 'junio', 7 => 'julio', 8 => 'agosto',
        9 => 'septiembre', 10 => 'octubre', 11 => 'noviembre', 12 => 'diciembre'
    ];
    return $meses[$mes] ?? 'mes';
}
function numeroEnLetras($num)
{
    $numeros = [
        1 => 'uno', 2 => 'dos', 3 => 'tres', 4 => 'cuatro', 5 => 'cinco',
        6 => 'seis', 7 => 'siete', 8 => 'ocho', 9 => 'nueve', 10 => 'diez',
        11 => 'once', 12 => 'doce', 13 => 'trece', 14 => 'catorce', 15 => 'quince', 16 => 'dieciséis', 17 => 'diecisiete',
        18 => 'dieciocho', 19 => 'diecinueve', 20 => 'veinte', 21 => 'veintiuno', 22 => 'veintidós',
        23 => 'veintitrés', 24 => 'veinticuatro', 25 => 'veinticinco', 26 => 'veintiséis', 27 => 'veintisiete',
        28 => 'veintiocho', 29 => 'veintinueve', 30 => 'treinta', 31 => 'treinta y uno',
    ];

    return $numeros[$num] ?? $num;
}

?>